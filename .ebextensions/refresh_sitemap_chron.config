files:
    "/etc/cron.d/mycron":
        mode: "000644"
        owner: root
        group: root
        content: |
            */10 * * * * root /usr/local/bin/myscript.sh

    "/usr/local/bin/myscript.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash
            # Script for reactivating sitemap
            cd /var/app/current/public
            cronlog="/var/app/current/cronlog.txt"
            sudo touch $cronlog
            sudo chmod 777 $cronlog
            echo "Starting cron script $(date)" >> $cronlog
            count=$(ls | grep sitemap | wc -l)
            if [ $count == 0 ]
            then
                echo "refreshing sitemaps $(date)" >> $cronlog
                cd ..
                sudo chmod 777 public
                rake sitemap:refresh
                echo "finished sitemap rake $(date)" >> $cronlog
            fi

            exit 0

commands:
    remove_old_cron:
        command: "rm -f /etc/cron.d/*.bak && rm -f /usr/local/bin/*.bak"
